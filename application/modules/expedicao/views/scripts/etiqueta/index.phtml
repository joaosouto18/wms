<h2>Expedição: <?php echo $this->expedicao ?></h2>
<div class="padding-top">

    <?php if ($this->cargas) : ?>
        <p><b>Selecione as cargas</b> - <label><input style="vertical-align: middle" type="checkbox" id="todos"> Selecione Todas</label><br></p>

        <div id="cargas">
            <?php foreach($this->cargas as $carga) : ?>
                <label>
                <input
                       class="checkBoxClass"
                       style="vertical-align: middle"
                       type="checkbox"
                       name="cargas"
                       value="<?php echo $carga['codCargaExterno']?>"
                       >
                Carga <?php echo $carga['codCargaExterno']?>
                </label><br />
            <?php endforeach ?>
        </div>
    <?php endif; ?>

    <br><p><b>Selecione a central de entregas</b></p>
    <ul id="centrais">
        <input type="hidden" id="controller" value="<?php echo $this->controller; ?>">
        <input type="hidden" id="action" value="<?php echo $this->action; ?>">
        <input type="hidden" id="expedicao" value="<?php echo $this->expedicao ?>">
        <?php foreach($this->centraisEntrega as $central) : ?>
            <li>
                <input type="button" class="btn" id="<?php echo $central['centralEntrega'] ?>" value="Central <?php echo $central['centralEntrega'] ?>" name="central-<?php echo $central['centralEntrega'] ?>">
            </li>
        <?php endforeach; ?>
    </ul>
</div>

<script>
    $(function(){

        $('#todos').click(function () {
            var checked_status = this.checked;
            $(".checkBoxClass").each(function() {
                this.checked = checked_status;
            });
        });

        $('.btn').click(function (a) {
            var arr = [];
            for (var i = 0; i < $('input[name="cargas"]:checked').length; i++) {
                arr[i] = $('input[name="cargas"]:checked')[i].value;
            }
//            if (arr.length == 0){
//                alert("Selecione uma carga!");
//                return false;
//            }
            $.ajax({
                url: URL_MODULO + '/' + $('#controller').val() + '/' + $('#action').val() + '/id/' + $('#expedicao').val() + '/central/' + $(this).attr('id'),
                type: 'POST',
                data: { cargas: arr },
                success: function(data){
                    if (data.status == 'error') {
                        if (data.link == ''){
                            alert(data.msg);
                        } else {
                            if(confirm(data.msg)){
                                window.open(data.link,'_blank')
                            }
                        }
                        return
                    }
                    a.preventDefault();
                    $.wmsDialogAjax({
                        width: 750,
                        height: 450,
                        url: '/expedicao/etiqueta/listar-mapas-quebra-ajax/id/'+$('#expedicao').val(),
                        title: 'Mapas Pendentes de Impressão'
                    });
                }
            });
        });
    });
</script>