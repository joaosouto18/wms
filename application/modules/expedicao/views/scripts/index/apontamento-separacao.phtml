<script>
    function gotoFinal(event) {
        if (event.which == 13 || event.keyCode == 13) {
            if (document.getElementById('etiquetas-etiquetaInicial').value != "") {
                codBarrasFinal   = document.getElementById('etiquetas-etiquetaFinal');
                if (codBarrasFinal) {
                    codBarrasFinal.focus();
                    if(event.preventDefault) {
                        event.preventDefault();
                    } else {
                        event.returnValue = false;
                    }
                }
            }
        }
        return true;
    }

    function gotoPessoa(event) {
        if (event.which == 13 || event.keyCode == 13) {
            if (document.getElementById('etiquetas-etiquetaFinal').value != "") {
                pessoa   = document.getElementById('etiquetas-pessoa');
                if (pessoa) {
                    pessoa.focus();

                    if(event.preventDefault) {
                        event.preventDefault();
                    } else {
                        event.returnValue = false;
                    }
                }
            }
        }
        return true;
    }

    function gotoBuscar(event) {
        if (event.which == 13 || event.keyCode == 13) {
            if (document.getElementById('etiquetas-pessoa').value != "") {
                buscar   = document.getElementById('etiquetas-buscar');
                if (buscar) {
                    buscar.focus();

                    if(event.preventDefault) {
                        event.preventDefault();
                    } else {
                        event.returnValue = false;
                    }
                }
            }
        }
        return true;
    }

    function gotoPessoaMapa(event) {
        if (event.which == 13 || event.keyCode == 13) {
            if (document.getElementById('mapas-codMapaSeparacao').value != "") {
                pessoa   = document.getElementById('mapas-pessoa');
                if (pessoa) {
                    pessoa.focus();

                    if(event.preventDefault) {
                        event.preventDefault();
                    } else {
                        event.returnValue = false;
                    }
                }
            }
        }
        return true;
    }

    function gotoSalvarMapa(event) {
        if (event.which == 13 || event.keyCode == 13) {
            if (document.getElementById('mapas-pessoa').value != "") {
                buscar   = document.getElementById('mapas-salvarMapa');
                if (buscar) {
                    buscar.focus();

                    if(event.preventDefault) {
                        event.preventDefault();
                    } else {
                        event.returnValue = false;
                    }
                }
            }
        }
        return true;
    }

    $(function () {
        $('#mapas-salvarMapa').click(function () {
            var mapa = $('#mapas-codMapaSeparacao').val();
            var cpf = $('#mapas-pessoa').val();

            if (cpf == null || cpf == ""){
                alert("Informe um CPF");
                return false;
            } else if (cpf.length != 14) {
                alert("CPF incompleto ou inv�lido");
                return false;
            }

            $.ajax({
                url: 'conferente-apontamento-separacao/cpf/'+cpf,
                success: function (data) {
                    var tr = $('<tr>').addClass('gTResultSet');
                    tr.append($('<td>').css('text-align','left'));
                    tr.append($('<td>').css('text-align','left').text(data[0]['NOM_PESSOA']));
                    tr.append($('<td class="identifica">').css('text-align','left').text(cpf));
                    tr.append($('<td class="intervalo">').css('text-align','left').text(mapa));
                    tr.append($('<td>').css('text-align','left').text(1));
                    tr.append($('<td class="tipo">').css('text-align','left').text('Mapas'));
                    $('#tbResult').append(tr);
                }
            });
        });
    });



    $(function(){

        $("#etiquetas-buscar").click(function () {

            var eI = $('#etiquetas-etiquetaInicial').val();
            var eF = $('#etiquetas-etiquetaFinal').val();

            var qtdEtiquetas = 0;
            var intervalo = "N/D";

            if (eI != '' && eF != '') {

                if (eI.length < 2 || eF.length < 2) {
                    alert("Etiqueta fora do padr�o");
                    return false;
                }

                eI = parseInt(eI.substring(0, eI.length - 1));
                eF = parseInt(eF.substring(0, eF.length - 1));

                if (eI > eF) {
                    alert("A etiqueta inicial n�o pode ser maior que a final.");
                    return false;
                } else if (eI == eF){
                    qtdEtiquetas = 1;
                    intervalo = eI + " - " + eF;
                } else {
                    qtdEtiquetas = eF - eI;
                    intervalo = eI + " - " + eF;
                }

            } else if (eI != "" && eF == "") {
                alert("N�o � poss�vel definir o intervalo sem a etiqueta final");
                return false;
            } else if (eI == "" && eF != "") {
                alert("N�o � poss�vel definir o intervalo sem a etiqueta inicial");
                return false;
            }

            var cpf = $('#etiquetas-pessoa').val();

            if (cpf == null || cpf == ""){
                alert("Informe um CPF");
                return false;
            } else if (cpf.length != 14) {
                alert("CPF incompleto ou inv�lido");
                return false;
            }

            $.ajax({
                url: 'conferente-apontamento-separacao/cpf/'+cpf,
                success: function (data) {
                    var tr = $('<tr>').addClass('gTResultSet');
                    tr.append($('<td>').css('text-align','left'));
                    tr.append($('<td>').css('text-align','left').text(data[0]['NOM_PESSOA']));
                    tr.append($('<td class="identifica">').css('text-align','left').text(cpf));
                    tr.append($('<td class="intervalo">').css('text-align','left').text(intervalo));
                    tr.append($('<td>').css('text-align','left').text(qtdEtiquetas));
                    tr.append($('<td class="tipo">').css('text-align','left').text('Etiquetas'));
                    $('#tbResult').append(tr);
                }
            });
        });
    });

    $(function(){
        $('.save').click(function () {
            $.each($('.gTResultSet').find('td.identifica'), function (key, value) {
                var etiquetas = $('.gTResultSet').find('td.intervalo')[key].innerText;
                var cpf = value.innerText;
                var tipo = $('.gTResultSet').find('td.tipo')[key].innerText;
                $.ajax({
                    url: 'apontamento-separacao/cpf/'+cpf+'/etiquetas/'+etiquetas+'/tipo/'+tipo,
                    success: function (data) {
                        alert('Todas as etiquetas foram salvas com sucesso!');
                        window.location.href = 'apontamento-separacao';
                    }

                });
            });
        });
    });
</script>

<?php
echo $this->form;
?>
<div id="exibe-pessoa-grid" class="grid">
    <table class="gTable ">
        <caption>Conferentes</caption>
        <tr class ="gTTitle">
            <td></td>
            <td width="30%">Nome</td>
            <td width="20%">CPF</td>
            <td width="15%">Inicial/Final</td>
            <td width="15%">Qtd. Etiquetas</td>
            <td width="15%">Tipo Confer�ncia</td>
        </tr>
        <tbody id="tbResult">
        </tbody>
    </table>
</div>


