<script>
    function gotoFinal(event) {
        if (event.which == 13 || event.keyCode == 13) {
            if (document.getElementById('etiquetas[etiquetaInicial]').value != "") {
                codBarrasFinal   = document.getElementById('etiquetas[etiquetaFinal]');
                if (codBarrasFinal) {
                    codBarrasFinal.focus();
                    if(event.preventDefault) {
                        event.preventDefault();
                    } else {
                        event.returnValue = false;
                    }
                }
            }
        }
        return true;
    }

    function gotoPessoa(event) {
        if (event.which == 13 || event.keyCode == 13) {
            if (document.getElementById('etiquetas[etiquetaFinal]').value != "") {
                pessoa   = document.getElementById('pessoa');
                if (pessoa) {
                    pessoa.focus();

                    if(event.preventDefault) {
                        event.preventDefault();
                    } else {
                        event.returnValue = false;
                    }
                }
            }
        }
        return true;
    }
    $(function(){

        $("#etiquetas-buscar").click(function () {

            var eI = $('#etiquetas-etiquetaInicial').val();
            var eF = $('#etiquetas-etiquetaFinal').val();

            var qtdEtiquetas = 0;
            var intervalo = "N/D";

            if (eI != '' && eF != '') {

                if (eI.length < 2 || eF.length < 2) {
                    alert("Etiqueta fora do padrão");
                    return false;
                }

                eI = parseInt(eI.substring(0, eI.length - 1));
                eF = parseInt(eF.substring(0, eF.length - 1));

                if (eI > eF) {
                    alert("A etiqueta inicial não pode ser maior que a final.");
                    return false;
                } else if (eI == eF){
                    qtdEtiquetas = 1;
                    intervalo = eI + " / " + eF;
                } else {
                    qtdEtiquetas = eF - eI;
                    intervalo = eI + " / " + eF;
                }

            } else if (eI != "" && eF == "") {
                alert("Não é possível definir o intervalo sem a etiqueta final");
                return false;
            } else if (eI == "" && eF != "") {
                alert("Não é possível definir o intervalo sem a etiqueta inicial");
                return false;
            }

            var cpf = $('#etiquetas-pessoa').val();

            if (cpf == null || cpf == ""){
                alert("Informe um CPF");
                return false;
            } else if (cpf.length != 14) {
                alert("CPF incompleto ou inválido");
                return false;
            }

            $.ajax({
                url: 'conferente-apontamento-separacao/cpf/'+cpf,
                success: function (data) {
                    var tr = $('<tr>').addClass('gTResultSet');
                    tr.append($('<td>').css('text-align','left'));
                    tr.append($('<td>').css('text-align','left').text(data[0]['NOM_PESSOA']));
                    tr.append($('<td>').css('text-align','left').text(cpf));
                    tr.append($('<td>').css('text-align','left').text(intervalo));
                    tr.append($('<td>').css('text-align','left').text(qtdEtiquetas));
                    $('#tbResult').append(tr);
                }
            });
        });
    });
</script>

<?php
echo $this->form;
echo $this->formMapaSeparacao;
?>
<div id="exibe-pessoa-grid" class="grid">
    <table class="gTable ">
        <caption>Conferentes</caption>
        <tr class ="gTTitle">
            <td></td>
            <td width="45%">Nome</td>
            <td width="20%">CPF</td>
            <td width="15%">Inicial/Final</td>
            <td width="15%">Qtd. Etiquetas</td>
        </tr>
        <tbody id="tbResult">
        </tbody>
    </table>
</div>


