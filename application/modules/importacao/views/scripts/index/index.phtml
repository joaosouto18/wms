<?php
    $this->headScript()->appendFile('/jquery-ui-1.11.4/jquery-ui.js');
    $this->headLink()->appendStylesheet('/jquery-ui-1.11.4/jquery-ui.css');
    $this->headLink()->appendStylesheet('/css/progress-bar/progress-bar-style.css');

//echo $this->form;
?>
<div align="center">
    <button type="button" id="startImport">Iniciar importação</button>
    <div class="row">
        <div class="progress-bar-div">
            <div id="pbArquivo"></div>
            <div align="center" class="progress-bar-text">
                <b id="pbTxtArquivo">Arquivo 0 de 0</b>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="progress-bar-div">
            <div id="pbLinha"></div>
            <div align="center" class="progress-bar-text">
                <b id="pbTxtLinha">Linha 0 de 0</b>
            </div>
        </div>
    </div>
    <div class="row" id="tbError" style="display: none">
        <p>Erro(s) no(s) arquivo(s):</p>
        <table class="table">
            <thead>
                <tr>
                    <th>Arquivo</th>
                    <th>Linha</th>
                    <th>Conteúdo</th>
                </tr>
            </thead>
            <tbody id="tbErrResult">
            </tbody>
        </table>
    </div>
    <div id="excptRw" style="display: none">
        <p>Erro de exceção:</p>
        <h2 style="color: red;" id="excptMsg"></h2>
    </div>
    <iframe src="" id="frameTeste" style="display: none"></iframe>
</div>

<script type="text/javascript">
    $("#pbArquivo").progressbar();
    $("#pbLinha").progressbar();
    $("#startImport").click(function () {
        $("#frameTeste").attr("src", URL_MODULO + "/index/iniciar-ajax");
    });
    function Zend_ProgressBar_Update(data)
    {
        var status = data.text;
        if (status != null) {
            $("#pbArquivo").progressbar({value: status.iArquivo, max: status.tArquivo});
            $("#pbTxtArquivo").text("Arquivo " + status.iArquivo + " de " + status.tArquivo);
            $("#pbLinha").progressbar({value: status.iLinha, max: status.tLinha});
            $("#pbTxtLinha").text("Linha " + status.iLinha + " de " + status.tLinha);
            if (status.error != null){
                $.each( status.error, function( arquivo, arrLines ) {
                    $.each( arrLines, function( linha, conteudo ) {
                        $("#tbErrResult").append(
                            "<tr>" +
                                "<td>" + arquivo + "</td>" +
                                "<td>" + linha + "</td>" +
                                "<td>" + conteudo + "</td>" +
                            "</tr>"
                        );
                    })
                });
                $("#tbError").show();
            }
            if (status.exception != null){
                $("#excptMsg").text(status.exception);
                $("#excptRw").show();
            }
        }
    }
</script>